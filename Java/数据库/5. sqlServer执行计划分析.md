# SQLServer执行计划分析

## 分析SQL写的好不好

1. SQLServer中对应MySQL EXPLAIN命令的语句如下：

```sql
SET STATISTICS PROFILE ON;
GO
SELECT * FROM biz_energy_consumption WHERE data_month = 12 and data_year = 2025
GO
SET STATISTICS PROFILE OFF;
```

输出字段如下：
![alt text](image-14.png)
![alt text](image-15.png)

其中的**PhysicalOP物理执行算子**比较重要，常见值及含义如下

| PhysicalOp     | 含义           |
| -------------- | ------------ |
| Index Seek     | 索引精准查找       |
| Index Scan     | 扫描索引         |
| Table Scan     | 全表扫描         |
| Nested Loops   | 嵌套循环 JOIN    |
| Hash Match     | 哈希 JOIN / 聚合 |
| Sort           | 排序           |
| Compute Scalar | 计算列          |
| Filter         | 条件过滤         |

## 查看运行时资源 --> SQL写的好但是运行时资源不足，也会导致查询很慢才返回结果 --> 偏向于运维（苏虹能源）

1. 查询请求运行情况
```sql
SELECT *
FROM sys.dm_exec_requests;
```
![alt text](image-16.png)

wait_type可以看出来SQL Server是在等锁、等IO还是等可用查询内存；

2. 查询内存使用情况和内存配置
![alt text](image-17.png)

3. 查询当前的内存请求情况
![alt text](image-18.png)